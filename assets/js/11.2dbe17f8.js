(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{209:function(t,s,e){"use strict";e.r(s);var a=e(28),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"ssr-构建流程（下）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssr-构建流程（下）"}},[t._v("#")]),t._v(" SSR 构建流程（下）")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),e("p",[t._v("使用依赖版本以及样例源码参考 "),e("a",{attrs:{href:"https://github.com/Styx11/vue-ssr-base",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Styx11/vue-ssr-base"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("文章所描述的构建场景基于 Koa2 和 Webpack4 并假定读者学习过 Vue SSR "),e("a",{attrs:{href:"https://ssr.vuejs.org/zh/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93-ssr-%EF%BC%9F",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("strong",[t._v("原创文章，转载请联系作者"),e("a",{attrs:{href:"https://github.com/Styx11",target:"_blank",rel:"noopener noreferrer"}},[t._v("Styx"),e("OutboundLink")],1),t._v("！")])])]),t._v(" "),e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),e("p",[t._v("通过"),e("RouterLink",{attrs:{to:"/blog/FontEnd_Construction/ssr_second_part.html"}},[t._v("中篇")]),t._v("的介绍我们将 Vue SSR 应用与 Koa2 服务器结合，并通过组合中间件提供了路由、文件服务功能。我们使用的"),e("code",[t._v("renderer")]),t._v("都是通过直接引用打包文件创建的：")],1),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// server.js")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" createBundleRenderer "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue-server-renderer'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" clientManifest "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./dist/vue-ssr-client-manifest.json'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serverBundle "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./dist/vue-ssr-bundle.json'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" template "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./src/template/index.html'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" renderer "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("createBundleRenderer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serverBundle"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  runInNewContext"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  clientManifest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  template\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("这是很自然的，但是在开发过程中每次修改"),e("code",[t._v("src")]),t._v("目录下的源文件时都要重新调用"),e("code",[t._v("npm run build")]),t._v("打包文件并刷新浏览器，这大大降低了我们的开发效率。")]),t._v(" "),e("p",[t._v("那么在这里，我将向你展示如何通过适配 Webpack4 中间件"),e("code",[t._v("devMiddleware")]),t._v("和"),e("code",[t._v("hotMiddleware")]),t._v("来与现有的 Koa2 服务器整合以提供高效自然的开发模式。这是我目前踩坑最多的构建过程，因为它不在 Vue SSR 文档的介绍里，要求我们更多地关注整个前端开发生态、查阅它们的源码、参考旧版本库的模式从而找到一个适配方案，我也真正体会到了阅读源码对个人能力提升有多大的帮助，所以在这篇总结中我会通过中间件的源码告诉你它们都做了那些工作从而进行适配。")]),t._v(" "),e("p",[t._v("我将这篇总结按这样的结构向你展示：以中间件划分，从源码角度分析它们做了那些工作、如何影响 webpack 实例"),e("code",[t._v("complier")]),t._v("，以及如何将它整合到现有服务器中。源码部分我会做精简以关注主要的功能。")]),t._v(" "),e("p",[t._v("当然你可以跳过源码解析直接看适配部分:)")]),t._v(" "),e("h2",{attrs:{id:"devmiddleware"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#devmiddleware"}},[t._v("#")]),t._v(" devMiddleware")])])}),[],!1,null,null,null);s.default=n.exports}}]);